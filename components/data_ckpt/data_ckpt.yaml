$schema: https://azuremlschemas.azureedge.net/latest/commandComponent.schema.json
type: command

# General information about the component
name: data_ckpt
display_name: Data checkpoint
description: A template component to fetch blobs from a container, by agreeing with a regex expression, and create a Data Asset in AzureML.
tags:
  author: Antonio Zarauz Moreno, CEO @MAIACorp
  version: "1"

# Inputs and outputs
inputs:
  subscription_id:
    type: string
    optional: false
  resource_group:
    type: string
    optional: false
  aml_workspace_name:
    type: string
    optional: false
  data_asset_name:
    type: string
    optional: false
  target_var:
    type: string
    optional: false
outputs:
  output_path:
    type: uri_folder

# The source code path of it's defined in the code section and when the
# component is run in cloud, all files from that path will be uploaded
# as the snapshot of this component
code: ./

# Environment takes care of source image and dependencies
# https://learn.microsoft.com/en-us/azure/machine-learning/how-to-manage-environments-v2?view=azureml-api-2&tabs=cli
environment:
  conda_file: ./conda.yaml
  image: mcr.microsoft.com/azureml/openmpi4.1.0-ubuntu20.04

# Cluster instance
compute: azureml:cpu-cluster

# Distribution type
distribution:
  type: mpi
  process_count_per_instance: 1 # Number of nodes per instance

# How many VMs we need
resources:
  instance_count: 1 # Number of instances to create

# The command section specifies the command to execute while running
# this component
command: python ./main.py --subscription_id ${{inputs.subscription_id}} --resource_group ${{inputs.resource_group}} --aml_workspace_name ${{inputs.aml_workspace_name}} --data_asset_name ${{inputs.data_asset_name}} --target_var ${{inputs.target_var}} --output_path ${{outputs.output_path}}